(function(){var u={questionnaires:"שאלונים",questionnaire:"שאלון",abilities:"יכולות",ability:"יכולת",legendGreenCircle:"מציין כי השאלון הינו האחרון בתיקיה עבור חלק מהתלמידים.",legendAbilityFinished:"סיים שלב",legendAbility:"לא סיים שלב",chartName:"יכולות תלמידים"},n=function(){var n={top:27,right:50,bottom:50,left:50},t=1e3,i=500,r=t-n.left-n.right,u=i-n.top-n.bottom;return{margin:n,outerWidth:t,outerHeight:i,width:r,height:u,xLabelHeight:10}}(),i=function(){function e(){var o,s,h,c,e;i.yAxisScale=d34.scaleLinear().domain([100,0]).range([0,n.height]);o=d34.axisLeft(i.yAxisScale).tickSize(n.width);s=t.svg.append("g").classed("y axis",!0).call(o).attr("transform","translate("+n.width+", 0)");s.append("text").classed("students-ability-chart__axis-label",!0).attr("transform","rotate(-90)").attr("y",-n.width-n.margin.left).attr("x",-(n.height/2-20)).attr("dy",".71em").style("text-anchor","end").text(u.ability);i.xAxisScale=d34.scaleLinear().domain([0,r.root.folder.questionnaires.length]).range([0,n.width]);h=d34.axisBottom(i.xAxisScale).ticks(r.root.folder.questionnaires.length).tickSize(-n.height).tickFormat(function(n){return n===0?"":n});c=t.svg.append("g").classed("x axis",!0).attr("transform","translate(0,"+n.height+")").call(h);c.append("text").classed("students-ability-chart__axis-label",!0).attr("x",n.width/2+30).attr("y",n.margin.bottom-3).style("text-anchor","end").text(u.questionnaire);e=t.svg.selectAll(".x .tick text");e.attr("y",n.xLabelHeight);e.on("mouseover",function(t){if(t!=0){f.style("display","");f.html(function(){return r.root.folder.questionnaires[t-1].name});var u=i.yAxisScale(0)+n.margin.top-f.node().getBoundingClientRect().height+15,e=i.xAxisScale(t)+n.margin.left-f.node().getBoundingClientRect().width/2;f.style("transform","translate("+e+"px ,"+u+"px )").transition().duration(350).style("opacity",.8)}}).on("mouseout",function(){f.transition().duration(350).style("opacity",0).on("end",function(){f.style("display","none")})});t.svg.selectAll(".tick text").classed("students-ability-chart__axis-tick-text",!0);t.svg.selectAll(".tick line").classed("students-ability-chart__grid-line",!0);t.svg.selectAll(".tick").classed("students-ability-chart__axis-tick",!0)}var f=d34.select(".students-ability-chart").append("div").attr("class","questionnaire-tip").style("opacity",0);return{yAxisScale:null,xAxisScale:null,init:e}}(),r=function(){function t(n){return decodeURIComponent(document.location.search)?JSON.parse(decodeURIComponent(document.location.search.substring(1))):n}function i(n){r.root=t(n)}function u(n){return r.root.folder.questionnaires[n-1].name}var n;return{init:i,root:n,getQuestionaireNameByOrder:u}}(),f=function(){function o(n){return"translate("+i.xAxisScale(n["questionnaire-order"])+","+i.yAxisScale(n.value)+")"}function s(n){for(var t=0;t<n.students.length;t++)if(n.students[t].finished)return!0;return!1}function h(o){var s,h,c;f.html(function(){for(var t,i='<div class="ability-tip__title" >'+r.getQuestionaireNameByOrder(o["questionnaire-order"])+" - "+u.ability+" "+o.value+"<\/div>",n=0;n<o.students.length;n++)t="<span>"+o.students[n].name+"<\/span><br>",o.students[n].finished&&(t=t.replace("span","span class='ability-tip__student--finished'")),i+=t;return i});s=-12;f.style("display","");h=i.yAxisScale(o.value)+n.margin.top-e(o)-f.node().getBoundingClientRect().height-s;c=i.xAxisScale(o["questionnaire-order"])+n.margin.left-f.node().getBoundingClientRect().width/2;f.style("transform","translate("+c+"px ,"+h+"px )").transition().duration(350).style("opacity",.8);t.svg.selectAll(".x.axis .students-ability-chart__axis-tick:nth-child("+(o["questionnaire-order"]+2)+")").classed("students-ability-chart__axis-tick--strong",!0);t.svg.selectAll(".y.axis .students-ability-chart__axis-tick:nth-child("+(12-o.value/10)+")").classed("students-ability-chart__axis-tick--strong",!0)}function c(n){f.transition().duration(350).style("opacity",0).on("end",function(){f.style("display","none")});t.svg.selectAll(".x.axis .students-ability-chart__axis-tick:nth-child("+(n["questionnaire-order"]+2)+")").classed("students-ability-chart__axis-tick--strong",!1);t.svg.selectAll(".y.axis .students-ability-chart__axis-tick:nth-child("+(12-n.value/10)+")").classed("students-ability-chart__axis-tick--strong",!1)}function e(n){return Math.sqrt(n.students.length)*13}function l(){f=d34.select(".students-ability-chart").append("div").attr("class","ability-tip").style("opacity",0);var i=r.root.folder.abilities.sort(function(n,t){return t.students.length-n.students.length}),u=t.svg.append("svg").classed("objects",!0).attr("width",n.width).attr("height",n.height);u.selectAll(".ability").data(i).enter().append("circle").classed("ability",!0).classed("finished",s).attr("r","1").attr("transform",o).on("mouseover",h).on("mouseout",c).transition().attr("r",e).duration(1e3)}var f;return{init:l}}(),t=function(){function e(){var u=document.createElement("div");u.classList.add("students-ability-chart__preloader");u.innerText="loading...";document.querySelector(".students-ability-chart").appendChild(u);d34.json("http://reports.dev.cet.ac.il/data/data.json",function(u){document.querySelector(".students-ability-chart__preloader").remove();t.svg=d34.select(".students-ability-chart").append("svg").attr("width",n.outerWidth).attr("height",n.outerHeight).append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")");o();r.init(u);i.init();f.init()})}function o(){var i=t.svg.append("g").classed("legend",!0).attr("transform",function(n,t){return"translate(0,"+t*20+")"}),r;i.append("circle").attr("r",10).attr("cx",n.width-7).attr("cy",-15).classed("ability",!0).classed("finished",!0);i.append("text").attr("y",-10).text(u.legendAbilityFinished).attr("x",n.width-20).classed("students-ability-chart__legend-text",!0);i.append("circle").classed("ability",!0).attr("r",10).attr("cx",n.width-95).attr("cy",-15);i.append("text").attr("y",-10).text(u.legendAbility).classed("students-ability-chart__legend-text",!0).attr("x",n.width-108);r=document.createElement("div");r.classList.add("students-ability-chart__title");r.innerHTML=u.chartName;document.querySelector(".students-ability-chart").prepend(r)}return{svg:null,init:e}}();window.cet=window.cet||{};window.cet.dashboard=window.cet.dashboard||{};cet.dashboard.studentsAbilityChart=t})(),function(){var n=function(){function n(n){var t=document.createElement("div"),i;t.classList.add("students-ability-dashboard");document.querySelector(n.rootElementSelector).appendChild(t);i=document.createElement("div");i.classList.add("students-ability-chart");t.appendChild(i);cet.dashboard.studentsAbilityChart.init(n)}return{init:n}}();window.cet=window.cet||{};window.cet.dashboard=window.cet.dashboard||{};cet.dashboard.studentsAbility=n}();